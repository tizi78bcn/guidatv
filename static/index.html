<!DOCTYPE html>
<html lang="it">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>Partite trasmesse</title>
    <style>
        body { font-family: Arial, sans-serif; }
        h1 { margin-bottom: 10px; }
        #filters label { margin-right: 8px; }
        table { border-collapse: collapse; margin-top: 16px; width: 100%; }
        th, td { border: 1px solid #444; padding: 6px 9px; text-align: center; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Partite trasmesse</h1>
    <div id="filters">
        <label>Data:
            <select id="filter-date"><option value="Tutte">Tutte</option></select>
        </label>
        <label>Squadra:
            <select id="filter-team"><option value="Tutte">Tutte</option></select>
        </label>
        <label>Competizione:
            <select id="filter-comp"><option value="Tutte">Tutte</option></select>
        </label>
        <input type="text" id="filter-search" placeholder="Cerca squadra...">
    </div>
    <table id="matches-table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Casa</th>
                <th>Trasferta</th>
                <th>Competizione</th>
                <th>Canale</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
let matches = [];

function formatDateDay(dateString) {
    const dateObj = new Date(dateString);
    const days = ["Dom", "Lun", "Mar", "Mer", "Gio", "Ven", "Sab"];
    const dayOfWeek = days[dateObj.getDay()];
    const day = String(dateObj.getDate()).padStart(2, '0');
    const month = String(dateObj.getMonth() + 1).padStart(2, '0');
    return `${dayOfWeek}, ${day}/${month}`;
}
function formatDateFull(dateString) {
    const dateObj = new Date(dateString);
    const days = ["Dom", "Lun", "Mar", "Mer", "Gio", "Ven", "Sab"];
    const dayOfWeek = days[dateObj.getDay()];
    const day = String(dateObj.getDate()).padStart(2, '0');
    const month = String(dateObj.getMonth() + 1).padStart(2, '0');
    const hours = String(dateObj.getHours()).padStart(2, '0');
    const mins = String(dateObj.getMinutes()).padStart(2, '0');
    return `${dayOfWeek}, ${day}/${month} - ${hours}:${mins}`;
}

// Fetch all matches from backend
async function fetchMatches() {
    const res = await fetch("/matches");
    matches = await res.json();
    populateFilters();
    renderTable();
}

function populateFilters() {
    const dateMap = new Map(), teamSet = new Set(), compSet = new Set();
    matches.forEach(m => {
        // Key giorno: "2025-10-19", label friendly: "Dom, 19/10"
        const onlyDay = m.date.slice(0,10);
        dateMap.set(onlyDay, formatDateDay(m.date));
        teamSet.add(m.home);
        teamSet.add(m.away);
        compSet.add(m.competition);
    });
    fillSelectCustom("filter-date", dateMap);
    fillSelect("filter-team", Array.from(teamSet));
    fillSelect("filter-comp", Array
